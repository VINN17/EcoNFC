<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Web NFC — Read & Write (Demo)</title>
  <style>
    :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{padding:18px;background:#f7f9fc;color:#111}
    .card{background:#fff;border-radius:10px;box-shadow:0 6px 18px rgba(20,30,60,0.08);padding:16px;max-width:760px;margin:12px auto}
    h1{font-size:20px;margin-bottom:6px}
    label{display:block;font-size:13px;margin-top:12px}
    input[type=text], textarea, select{width:100%;padding:10px;margin-top:6px;border:1px solid #dfe6f0;border-radius:8px}
    button{margin-top:10px;padding:10px 14px;border-radius:8px;border:0;background:#0b5fff;color:white;cursor:pointer}
    button.secondary{background:#2f3b46}
    pre{white-space:pre-wrap;background:#0f1724;color:#e6f0ff;padding:10px;border-radius:8px}
    .row{display:flex;gap:8px}
    .muted{color:#6b7280;font-size:13px}
  </style>
</head>
<body>
  <div class="card">
    <h1>Web NFC — Read &amp; Write (Demo)</h1>
    <p class="muted">Catatan: Web NFC hanya didukung di Chrome/Android (dan browser berbasis Chromium di Android). Aplikasi ini perlu dijalankan dari <strong>HTTPS</strong> atau <strong>localhost</strong>. Pastikan perangkat Android punya NFC dan NFC diaktifkan.</p>

    <label>Jenis tulis</label>
    <select id="recordType">
      <option value="text">Text (plain)</option>
      <option value="url">URL</option>
      <option value="mime">MIME (custom)</option>
    </select>

    <div id="mimeArea" style="display:none">
      <label>Mime type (contoh: text/plain)</label>
      <input id="mimeType" type="text" placeholder="text/plain">
    </div>

    <label>Data yang akan ditulis</label>
    <textarea id="writeData" rows="3" placeholder="Tulis teks atau URL di sini">Hello from Web NFC!</textarea>

    <div class="row">
      <button id="writeBtn">Tulis ke tag (Write)</button>
      <button id="readStartBtn" class="secondary">Mulai scan (Read)</button>
      <button id="readStopBtn" class="secondary" disabled>Stop scan</button>
    </div>

    <hr style="margin:14px 0">

    <h3>Status</h3>
    <div id="status" class="muted">Idle</div>

    <h3>Hasil bacaan tag</h3>
    <div id="result">
      <pre id="output">Belum ada data</pre>
    </div>

    <details style="margin-top:12px">
      <summary>Instruksi singkat</summary>
      <ol>
        <li>Jalankan file ini melalui server HTTPS (contoh: GitHub Pages, ngrok, atau server Anda sendiri).</li>
        <li>Buka halaman ini di Chrome pada perangkat Android yang memiliki NFC.</li>
        <li>Untuk menulis: pilih jenis (text/url/mime), isi data, lalu klik <em>Write</em> dan tempelkan tag NFC saat diminta.</li>
        <li>Untuk membaca: klik <em>Mulai scan</em> lalu dekatkan tag NFC ke perangkat.</li>
      </ol>
    </details>
  </div>

  <script>
    // Elemen
    const writeBtn = document.getElementById('writeBtn');
    const readStartBtn = document.getElementById('readStartBtn');
    const readStopBtn = document.getElementById('readStopBtn');
    const statusEl = document.getElementById('status');
    const outputEl = document.getElementById('output');
    const recordType = document.getElementById('recordType');
    const mimeArea = document.getElementById('mimeArea');
    const mimeTypeInput = document.getElementById('mimeType');

    let ndefReader = null;
    let scanController = null;

    // Tampilkan field MIME bila diperlukan
    recordType.addEventListener('change', () => {
      mimeArea.style.display = (recordType.value === 'mime') ? 'block' : 'none';
