<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Konfigurasi Perangkat</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Konfigurasi Perangkat NFC</h1>
    <div id="nfc-status"></div>
    <form id="config-form" style="display: none;">
        <label for="server-url">URL Server:</label>
        <input type="text" id="server-url" required>
        <br>
        <label for="sensor-threshold">Ambang Sensor:</label>
        <input type="number" id="sensor-threshold" required>
        <br>
        <button type="submit">Simpan Konfigurasi</button>
    </form>

    <script>
        $(document).ready(function() {
            // Fungsi untuk mendeteksi NFC
            function readNFC() {
                // Implementasi pembacaan NFC menggunakan Web NFC API
                if ('NFC' in window) {
                    const ndef = new NDEFReader();
                    ndef.scan().then(() => {
                        console.log("Scan NFC...");
                        ndef.onreading = event => {
                            const message = event.message;
                            console.log("NFC Tag dibaca!", message);
                            // Sembunyikan pesan status dan tampilkan form
                            $('#nfc-status').text('NFC Tag sudah terbaca.');
                            $('#config-form').show();
                        };
                    }).catch(error => {
                        console.error("NFC tidak tersedia:", error);
                    });
                } else {
                    $('#nfc-status').text('NFC tidak didukung di browser ini.');
                }
            }

            // Saat form disubmit
            $('#config-form').on('submit', function(event) {
                event.preventDefault();
                const serverUrl = $('#server-url').val();
                const threshold = $('#sensor-threshold').val();

                // Kirim data ke ESP32 via API
                $.ajax({
                    url: 'http://ESP32_IP_ADDRESS/config', // Ganti dengan alamat ESP32 Anda
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ serverUrl, threshold }),
                    success: function(response) {
                        alert('Konfigurasi disimpan!');
                    },
                    error: function(error) {
                        alert('Gagal menyimpan konfigurasi:', error);
                    }
                });
            });

            readNFC(); // Mulai membaca NFC saat halaman dimuat
        });
    </script>
</body>
</html>
